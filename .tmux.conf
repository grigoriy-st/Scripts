# Terminal settings - АДАПТИРОВАНО ДЛЯ TTY
set -g default-terminal "screen-256color"
set -ga terminal-overrides ',xterm*:smcup@:rmcup@'

set -g mouse off

bind c new-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"

setw -g mode-keys vi
set -g base-index 1
setw -g pane-base-index 1

bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi r send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel

bind p paste-buffer

bind C-y run-shell "tmux save-buffer - > ~/.tmux-buffer; echo 'Buffer saved to ~/.tmux-buffer'"
bind C-p run-shell "tmux load-buffer ~/.tmux-buffer 2>/dev/null; tmux paste-buffer; echo 'Buffer loaded from ~/.tmux-buffer'"

# Pane navigation with Alt - В TTY ALT МОЖЕТ НЕ РАБОТАТЬ
# Изменено на использование префикса для надежности
# bind -n M-h select-pane -L  # Убрано
# bind -n M-j select-pane -D  # Убрано
# bind -n M-k select-pane -U  # Убрано
# bind -n M-l select-pane -R  # Убрано

# ДОБАВЛЕНО: Альтернативная навигация без Alt для tty
bind -n C-h select-pane -L  # Ctrl+h
bind -n C-j select-pane -D  # Ctrl+j  
bind -n C-k select-pane -U  # Ctrl+k
bind -n C-l select-pane -R  # Ctrl+l

# Pane resizing - АДАПТИРОВАНО ДЛЯ TTY
# Убраны Alt комбинации, добавлены с префиксом
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ДОБАВЛЕНО: Ресайз с Ctrl для удобства
bind -n C-S-H resize-pane -L 5
bind -n C-S-J resize-pane -D 5
bind -n C-S-K resize-pane -U 5
bind -n C-S-L resize-pane -R 5

# Pane navigation with prefix (repeatable) - ОСТАВЛЕНО
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R

# Window navigation
bind -r H previous-window
bind -r L next-window

# ДОБАВЛЕНО: Проблемы с кодировкой в tty
set -g utf8 on
set -g status-utf8 on

set -g status-style "bg=black,fg=white"
set -g status-left "#[fg=green]#S #[fg=white]|"
set -g status-right "#[fg=yellow]%H:%M #[fg=white]| #[fg=cyan]%d.%m.%Y"

set -g alternate-screen on

# ДОБАВЛЕНО: Лучшая совместимость с vim в tty
set -g focus-events off
set -g aggressive-resize off

# ДОБАВЛЕНО: История прокрутки для tty
set -g history-limit 50000
set -g scroll-on-clear on

# ДОБАВЛЕНО: Явное указание режима для tty
set -g default-command "bash --norc"  # Можно убрать, если не нужно

# ДОБАВЛЕНО: Перезагрузка конфига
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# ДОБАВЛЕНО: Исправление backspace в tty
set -g terminal-overrides 'linux*:kbs=^H'
